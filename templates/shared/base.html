<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cigar Room</title>
    <!-- Fonts: Playfair Display (Headings) & Lora (Body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,600;0,700;0,900;1,400&display=swap"
        rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Lora', 'serif'],
                        serif: ['Playfair Display', 'serif'],
                        mono: ['Courier Prime', 'monospace'],
                    },
                    colors: {
                        // Classic Palette
                        leather: { DEFAULT: '#2C1810', light: '#3E2C26', dark: '#1a0f0a' },
                        gold: { DEFAULT: '#C5A028', light: '#D4AF37', dim: '#8A7019' },
                        parchment: { DEFAULT: '#E8E6D9', dark: '#d1cdc0' },
                        charcoal: '#121212'
                    },
                    backgroundImage: {
                        'classic-grain': "url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E\")",
                        'vignette': 'radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.6) 100%)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .classic-panel {
                @apply bg-leather-light border border-gold-dim/30 shadow-2xl shadow-black/50;
            }
            .classic-input {
                @apply bg-leather-dark border-b border-gold-dim text-parchment px-2 py-2 focus:outline-none focus:border-gold transition-colors font-sans;
            }
            .nav-link {
                @apply font-serif text-lg text-gold-dim hover:text-gold transition-colors italic tracking-wide;
            }
            .nav-link.active {
                @apply text-gold border-b border-gold;
            }
            .text-gold-gradient {
                @apply bg-clip-text text-transparent bg-gradient-to-r from-gold via-gold-light to-gold-dim;
            }
        }
        
        body {
            background-color: #1a0f0a;
        }
        @keyframes smokeDrift {
            0% { background-position: 0% 0%; transform: scale(1); }
            50% { background-position: 100% 50%; transform: scale(1.1); }
            100% { background-position: 0% 0%; transform: scale(1); }
        }
    </style>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>

<body
    class="bg-leather-dark text-parchment font-sans min-h-screen flex flex-col relative selection:bg-gold/30 selection:text-gold-light">

    <!-- Texture Overlay -->
    <div
        class="fixed inset-0 bg-[url('/static/img/bg-smoke.png')] bg-cover bg-center opacity-10 pointer-events-none z-0 mix-blend-screen animate-[smokeDrift_60s_linear_infinite]">
    </div>
    <div class="fixed inset-0 bg-classic-grain pointer-events-none z-0 opacity-30"></div>
    <div class="fixed inset-0 bg-vignette pointer-events-none z-0"></div>

    <nav class="border-b border-gold-dim/20 bg-leather/90 sticky top-0 z-50 backdrop-blur-sm relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <a href="/" class="flex flex-col items-start group mr-8" title="Switch Domain">
                        <span
                            class="font-serif text-2xl font-bold tracking-widest text-gold group-hover:text-gold-light transition">TIB
                            USA</span>
                        <span
                            class="text-[10px] uppercase tracking-[0.2em] text-stone-500 group-hover:text-gold-dim transition">Private
                            System</span>
                    </a>

                    <div class="hidden md:block">
                        <div class="flex items-baseline space-x-6">
                            <!-- Context switching Logic (Simple for now: Show relevant links based on path) -->
                            {% if '/cigar' in request.url.path or '/analytics' in request.url.path %}
                            <span class="text-xs font-mono text-stone-600 uppercase mr-4">Domain: Cigar</span>
                            <a href="/cigar" class="nav-link">Humidor</a>
                            <a href="/cigar/community" class="nav-link">Lounge</a>
                            <a href="/analytics" class="nav-link">Ledger</a>
                            {% elif '/garage' in request.url.path %}
                            <span class="text-xs font-mono text-stone-600 uppercase mr-4">Domain: Garage</span>
                            <a href="/garage" class="nav-link">Fleet</a>
                            {% elif '/armory' in request.url.path %}
                            <span class="text-xs font-mono text-stone-600 uppercase mr-4">Domain: Armory</span>
                            <a href="/armory" class="nav-link">Vault</a>
                            {% else %}
                            <!-- Portal View -->
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="hidden md:flex items-center gap-6">
                    {% if user %}
                    <div class="flex items-center gap-3 px-3 py-1">
                        <span class="text-xs font-mono text-gold-dim tracking-widest">{{ user.email }}</span>
                    </div>
                    <a href="/auth/profile"
                        class="text-xs font-bold uppercase tracking-widest text-parchment hover:text-gold transition-colors">Profile</a>
                    <a href="/auth/logout"
                        class="text-xs font-bold uppercase tracking-widest text-stone-500 hover:text-red-400 transition-colors">Sign
                        Out</a>
                    {% else %}
                    <a href="/auth/login" class="nav-link text-sm not-italic">Login</a>
                    {% endif %}
                </div>

                <!-- Mobile menu -->
                <div class="flex items-center gap-4 md:hidden">
                    {% if user %}
                    <a href="/auth/profile" class="text-gold-dim hover:text-gold p-2">
                        <span class="sr-only">Profile</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                        </svg>
                    </a>
                    {% endif %}
                    <button type="button" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')"
                        class="text-gold hover:text-white p-2">
                        <span class="sr-only">Menu</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div class="hidden md:hidden bg-leather border-b border-gold/10" id="mobile-menu">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <a href="/humidor" class="block py-2 text-gold font-serif text-lg">The Humidor</a>
                <a href="/humidor/community" class="block py-2 text-gold font-serif text-lg">The Lounge</a>
                <a href="/analytics" class="block py-2 text-gold font-serif text-lg">Ledger</a>
                <hr class="border-white/5 my-2">
                {% if user %}
                <a href="/auth/profile" class="block py-2 text-parchment font-serif italic">My Membership Card</a>
                <a href="/auth/logout" class="block py-2 text-stone-400 text-sm">Sign Out</a>
                {% else %}
                <a href="/auth/login" class="block py-2 text-gold">Login</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-12 relative z-10 w-full max-w-7xl">
        {% block content %}{% endblock %}
    </main>

    <footer
        class="border-t border-gold-dim/10 py-8 text-center text-stone-600 text-xs font-mono relative z-10 space-y-2">
        <p>&copy; 2026 Cigar Room. Purveyors of Fine Software.</p>
        <p class="text-stone-700">Questions? <a href="mailto:contact@tib-usa.com"
                class="text-gold-dim hover:text-gold transition">contact@tib-usa.com</a></p>
    </footer>

</body>

</html>